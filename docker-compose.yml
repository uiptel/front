version:  '3.7'

services:
  nginx:
    image: nginx:stable-alpine
    entrypoint: entrypoint.sh
    command:  ["nginx", "-g", "daemon off;"]
    working_dir: /usr/share/nginx/html
    environment:
      NODE_ENV: development
      BUILD_DATE: ${BUILD_DATE}
      VCS_REF: ${VCS_REF}
      VERSION: ${APP_VERSION}
      API_URL: https://uiptel.com/api
      DIGEST_IMAGE: DEV_BUILD_00000000FFFFFFFF
      EXPOSE_VARS: 'BUILD_DATE VCS_REF VERSION DIGEST_IMAGE HOSTNAME API_URL NODE_ENV'
 
    depends_on:
      - front
    volumes:
      - ./.docker/nginx.conf:/etc/nginx/conf.d/default.conf:ro
      - ./.docker/entrypoint.sh:/usr/local/bin/entrypoint.sh:ro
      - ./dist:/usr/share/nginx/html:rw
    ports:
      - 80:80

  front:
    container_name: ${CONTAINER_NAME}
    image: ${DEV_IMAGE}
    hostname: ${APP_NAME}
    working_dir: ${APP_PATH}
    command: ["sleep.js"]
    environment:
      NODE_ENV: development
      BUILD_DATE: ${BUILD_DATE}
      VCS_REF: ${VCS_REF}
      VERSION: ${APP_VERSION}
      API_URL: https://uiptel.com/api
      DIGEST_IMAGE: DEV_SERVE_00000000FFFFFFFF
    volumes:
      - /home/${USER_NAME}:/home/${USER_NAME}
      - ./:${APP_PATH}
    ports:
      - "4200:4200"

networks:
  default:
    driver: bridge
    name: ${NAMESPACE}
